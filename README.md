# Репозиторий с парсерами данных из дашборда ДГП и СУИД #
Тут у нас два парсера, первый (control_points_parser.py) по контрольным точкам, второй (cameras.py) для видеокамер.

## Описание программ ##

### Контрольные точки ###
Фактически, программа собирает данные примерно как это делал бы человек руками, только гораздо быстрее, чем больше объектов и дополнительных данных для проверки, тем больше времени займет работа программы. У учетной записи пользователя должен быть доступ к необходимым объектам в СУИД, чтобы программа могла получить оттуда данные.  
Для использования потребуются:  
1) Пароль и логин для СУДИР (чтобы собрать данные с дашборда).  
2) Пароль и логин в СУИД (чтобы получить данные из СУИД).  
Если в какую-то из систем не получится авторизоваться, вы получите ошибку. При запуске вы увидите следующие информационные сообщения: "Для проверки дополнительных контрольных точек положить их названия в control_points.xlsx", 'Чтобы отметить объекты как исключенные из проверки, надо поместить их id в файл excluded_objects.xlsx'.

#### Дополнительные работы ####

Чтобы проверить дополнительные работы по каждому объекту, в папку с программой надо положить файл control_points.xlsx. В нём должен быть столбец points (регистр важен!), каждая ячейка под ним должна содержать одно название работы. Как и для вчерашних фотографий, можно добавить дополнительные столбцы.  

##### Пример содержимого файла control_points.xlsx:  #####

points  
установка переносной ямы  
покраска реактора холодного синтеза в цвет морской волны  
монтаж газонного волочителя шланга  

#### Исключение объектов ####

Чтобы отметить объект как ненужный для проверки, в папку с программой надо положить файл excluded_objects.xlsx. В нем должен быть столбец id (регистр важен!), каждая ячейка под ним должна содержать один id объекта. Можно добавить дополнительные столбцы.

##### Пример содержимого файла excluded_objects.xlsx: #####
id  
234  
6742  
534  


При отсутствии какого-либо из файлов соответствующий шаг будет пропущен. 

В результате работы программы в папке с ней вы получите файл control_points_сегодняшняя_дата.xlsx 
Столбцы в файле: 
- `object_id` - id объекта на дашборде 
- `object_name` - название объекта 
- `status` - статус работы на дашборде. complete - завершена, in_progress - выполняется, no_control_points - у объекта нет контрольных точек на дашборде, additional_check - - дополнительная работа из файла control_points.xlsx 
- `name` - название работы 
- `project_manager` - руководитель объекта
- `developer` - заказчик 
- `plan_finish_date` - планируемая дата завершения 
- `fact_finish_date` - фактическая дата завершения 
- `plan` - см. `plan_finish_date`
- `fact` - см. `fact_finish_date`
- `planned_commissioning_directive_date` - плановый ввод по директивному графику
- `plan_start_date` - планируемая дата начала
- `fact_start_date` - планируемая дата завершения
- `plan_progress` - прогресс плана
- `fact_progress` - прогресс факта
- `readiness` - готовность
- `today` - сегодняшняя дата
- `suid_url` - ссылка на график объекта в СУИД
- `is_exceeded` - превышен ли срок
- `etapi_url` - ссылка на этапы объекта в дашборде ДГП
- `dashboard_url` - ссылка на объект в дашборде ДГП
- `control_point_comparsion` - может содержать "не найдена в СУИД", "объект exon", "дополнительная точка", "РАБОТА НЕ НАЙДЕНА" или ничего
- `suid_end` - дата окончания в СУИД.
- `suid_start` - дата начала в СУИД.
- `fact_end_date_suid` - фактическая дата окончания в суид.
- `is_dates_equal` - совпадает ли plan_finish_date и suid_end
- `found_in_suid` - найдена ли работа в СУИД (для работ из control_points.xlsx)
- `is_fact_date_suid_is_equal` - равны ли `plan_finish_date` и `fact_end_date_suid`
- `exclude_from_check` - исключение объекта из проверки
- `created_at`, `updated_at`, `deleted_at`, `color` - дополнительная информация.

### Видеокамеры ###

Парсер для проверки наличия видеокамер на страницах объектов дашборда ДГП. Проверяет только объекты по стадии СМР. Требуются логин и пароль для СУДИР (чтобы собрать данные с дашборда). В результате работы программы в папке с ней вы получите файл videos_сегодняшняя_дата.xlsx 
Столбцы в файле: 
- `name` - название объекта 
- `id` - id объекта на дашборде 
- `uin` - УИН объекта 
- `video` - "видео есть" или "видео нет"  

### Проверка фотографий ###

Требуются логин и пароль для СУДИР (чтобы собрать данные с дашборда). При запуске вы увидите информационное сообщение: "Для проверки вчерашних фотографий положить ID объектов в файл yesterday_photo_objects.xlsx"

Чтобы проверить наличие у объекта на дашборде фотографий за вчерашний день, в папку с программой надо положить файл yesterday_photo_objects.xlsx. В нём должен быть столбец id (регистр важен!), каждая ячейка под ним должна содержать один id объекта. Можно добавить дополнительные столбцы, например с названием объекта, UIN и т.д. для своего удобства, это не повлияет на работу программы. Проверяются только те объекты, id которых лежат в файле! В результате работы программы в папке с ней вы получите файл check_photo_сегодняшняя_дата.xlsx 

Столбцы в файле: 
- `photo_status` - статус фотографий. "нет фотографий", "есть совпадение" или "фото в порядке".
- `yesterday_photo` - для объектов из yesterday_photo.xlsx. Истина или ложь, либо ничего если объекта не было в файле.
- Информационные (`object_id`, `uin` и т.д.)

##### Пример содержимого файла yesterday_photo_objects.xlsx: ##### 

id  
1  
2  
3  
716243  
352  
Результаты для указанных в файле объектов смотреть в столбце yesterday_photo.  


## Клонирование репозитория ##

### Требования ###
- Git
- Python 3.12+
- [uv](https://docs.astral.sh/uv/) (менеджер пакетов и виртуальных окружений)

### Установка

1. Клонируйте репозиторий:
```bash
git clone https://github.com/Kodirovatel/dgp_parsers
cd dgp_parsers
```
2. Установите uv (если ещё не установлен):

**Windows:** 
```powershell 
powershell  -c "irm https://astral.sh/uv/install.ps1 | iex"
```
**Linux/macOS:** 
```bash
 curl -LsSf https://astral.sh/uv/install.sh | sh
 ```

3. Установите зависимости:
`uv sync`
4. Запустите программу:
`uv run python cameras.py`
или
`uv run python control_points_parser.py`
или
`uv run python check_photos.py`


## Создание standalone приложения ##
С установленным uv в терминале заходите в папку со скриптами и выполняете нужную команду:  
Для создания парсера контрольных точек  
`uv run python -m nuitka --standalone --mingw64 --nofollow-import-to=IPython --nofollow-import-to=jupyter --nofollow-import-to=notebook control_points_parser.py`  
Для создания парсера видеокамер  
`uv run python -m nuitka --standalone --mingw64 --nofollow-import-to=IPython --nofollow-import-to=jupyter --nofollow-import-to=notebook cameras.py` 
Для проверки фотографий
`uv run python -m nuitka --standalone --mingw64 --nofollow-import-to=IPython --nofollow-import-to=jupyter --nofollow-import-to=notebook check_photos.py`

В созданной папке control_points_parser.dist или cameras.dist или check_photos запускаете соответственно control_points_parser.exe, cameras.exe или check_photos.exe